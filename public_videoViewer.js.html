<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: public/videoViewer.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: public/videoViewer.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// videoViewer.js
// Handles logic for videoViewer page

//////////////////////////////
//     Global Variables     //
//////////////////////////////

const server_url = "http://localhost:4200"; // Endpoint to retrieve videos, should add a config option for this
const urlParams = new URLSearchParams(window.location.search);
const url = urlParams.get("url");
const role_div = document.getElementById("role_elements");
let role = undefined;

///////////////////////
//     Functions     //
///////////////////////

/**
 * @description Runs on click of a like/dislike radio button. 
 * @param {Number} opinion - 1 to like the video, 0 to dislike the video
 */
function onOpinionChange(opinion) {
  console.log("Opinion: " + opinion);

  fetch("/api/opinion?vid=" + url + "&amp;opinion=" + opinion).then(() => {
    console.log("Updating Opinions");
    console.log(role);
    if (role == undefined) {
      return;
    } else if (role == 2) {
      updateMarketingManager();
    }
  });
}
/**
 * @description Updates the display shown to Marketing Managers
 */
function updateMarketingManager() {
  console.log("Made it to update marketing manager");
  const q_url = url.split("embed/")[1].split("?")[0];

  // Fetch video to display likes/dislikes to Marketing Manager
  let req_url = server_url + "/api/videos?q=" + q_url + "&amp;fav=&amp;field=url";

  fetch(req_url)
    .then((response) => {
      if (!response.ok) {
        throw new Error("Failed to get video");
      }
      console.log("Response is good!");
      return response.json();
    })
    .then((json) => {
      console.log(json.videos[0]);
      console.log("Updating opinion labels");
      document.getElementById("like_label").innerHTML =
        "Likes: " + json.videos[0].likes;
      document.getElementById("dislike_label").innerHTML =
        "Dislikes: " + json.videos[0].dislikes;
    })
    .catch((error) => {
      console.error(
        "An error occurred with the updateMarketingManager fetch request: " +
          error,
      );
    });
}

/**
 * @description Updates the display shown to Content Editors
 */
function updateContentEditor() {
  console.log("Made it to update content editor");
  const q_url = url.split("embed/")[1].split("?")[0];

  // Fetch video to display comment to Content Editor
  let req_url = server_url + "/api/videos?q=" + q_url + "&amp;fav=&amp;field=url";

  fetch(req_url)
    .then((response) => {
      if (!response.ok) {
        throw new Error("Failed to get video");
      }
      console.log("Response is good!");
      return response.json();
    })
    .then((json) => {
      document.getElementById("view_comment").innerHTML =
        "Comment: " + json.videos[0].comment;
    })
    .catch((error) => {
      console.error(
        "An error occurred with the updateContentEditor fetch request: " +
          error,
      );
    });
}

/////////////////////////
//     Startup Ops     //
/////////////////////////

document.getElementById("backToGallery").onclick = function () {
  window.location.href = "/gallery";
};

let player = document.getElementById("video_player");
player.setAttribute("src", url);

const like_radio = document.getElementById("like");
const dislike_radio = document.getElementById("dislike");

like_radio.addEventListener("click", function () {
  onOpinionChange(1);
});

dislike_radio.addEventListener("click", function () {
  onOpinionChange(0);
});

fetch(server_url + "/api/whoami")
  .then((response) => {
    if (!response.ok) {
      throw new Error("Failed to get list of videos");
    }
    return response.json();
  })
  .then((json) => {
    role = json.role;

    if (json.role == 1) {
      // If the user is a Content Editor
      role_div.appendChild(document.createElement("br"));
      let view_comment = document.createElement("label");
      view_comment.id = "view_comment";
      role_div.appendChild(view_comment);

      updateContentEditor();
    } else if (json.role == 2) {
      // If user is a Marketing Manager
      let like_label = document.createElement("label");
      let dislike_label = document.createElement("label");
      let comment_form = document.createElement("form");
      let comment_text = document.createElement("input");
      let comment_submit = document.createElement("input");
      let static_data = document.createElement("input");

      like_label.id = "like_label";
      dislike_label.id = "dislike_label";

      comment_form.id = "comment_form";
      comment_form.name = "comment_form_name";
      comment_form.method = "POST";
      comment_form.action = server_url + "/api/upload_comment";

      comment_text.id = "comment_entry";
      comment_text.name = "comment";
      comment_text.type = "text";
      comment_text.placeholder = "Enter Your Comment Here...";

      static_data.id = "static_data";
      static_data.name = "url";
      static_data.value = url;
      static_data.type = "hidden";

      comment_submit.id = "comment_submit";
      comment_submit.type = "submit";
      comment_submit.innerText = "Submit";
      comment_submit.name = "submit_button";

      role_div.appendChild(like_label);
      role_div.appendChild(document.createElement("br"));
      role_div.appendChild(dislike_label);
      role_div.appendChild(document.createElement("br"));

      comment_form.appendChild(comment_text);
      comment_form.appendChild(comment_submit);
      comment_form.appendChild(static_data);
      role_div.appendChild(comment_form);

      updateMarketingManager();
    }
  })
  .catch((error) => {
    console.error("An error occurred with the initial fetch request: " + error);
  });
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-api.html">api</a></li><li><a href="module-middleware.html">middleware</a></li><li><a href="module-mongo.html">mongo</a></li><li><a href="module-validity.html">validity</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addUploadPageButton">addUploadPageButton</a></li><li><a href="global.html#onOpinionChange">onOpinionChange</a></li><li><a href="global.html#onSearchClick">onSearchClick</a></li><li><a href="global.html#populateVideo">populateVideo</a></li><li><a href="global.html#updateContentEditor">updateContentEditor</a></li><li><a href="global.html#updateDisplayedVideos">updateDisplayedVideos</a></li><li><a href="global.html#updateMarketingManager">updateMarketingManager</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Wed Apr 30 2025 15:04:45 GMT-0800 (Alaska Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
